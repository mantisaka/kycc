(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3dad4e13"],{"0799":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"myload main_container"},[i("home-header",{attrs:{pathName:""}}),i("div",{staticClass:"container",staticStyle:{padding:"20px 10px"}},[i("div",{staticClass:"center-box"},[i("div",{staticClass:"head"},[i("div",[t._v(t._s(t.$t("My Tickets")))]),i("div",[i("el-button",{attrs:{loading:t.listLoading,type:"info",icon:"el-icon-refresh-right",round:""},on:{click:t.getList}},[t._v(" "+t._s(t.$t("Refresh"))+" ")]),i("el-button",{attrs:{loading:t.btnLoading,type:"primary",icon:"el-icon-plus",round:""},on:{click:function(e){t.dialogNew=!0}}},[t._v(" "+t._s(t.$t("Customer Service"))+" ")])],1)]),i("div",{staticClass:"table1"},[0==t.listData.length||t.listLoading?i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticClass:"mask1"},[t.listLoading?t._e():i("div",{staticStyle:{"text-align":"center","line-height":"26px"}},[i("div",[i("svg-icon",{staticStyle:{"font-size":"42px",color:"#ccc","margin-bottom":"32px"},attrs:{slot:"image","icon-class":"no"},slot:"image"})],1),i("div",{staticStyle:{"font-size":"14px",color:"#999","margin-bottom":"12px"}},[t._v(t._s(t.$t("No Data")))]),i("div",[i("el-button",{attrs:{loading:t.btnLoading,type:"primary",icon:"el-icon-plus",round:""},on:{click:function(e){t.dialogNew=!0}}},[t._v(" "+t._s(t.$t("Customer Service"))+" ")])],1)])]):t._e(),i("el-table",{ref:"table",staticClass:"tabbox",staticStyle:{"margin-top":"22px"},attrs:{data:t.listData}},[i("template",{slot:"empty"},[i("div",{staticStyle:{height:"300px",color:"#FFF"}},[t._v("no data")])]),i("el-table-column",{attrs:{"min-width":"180",label:t.$t("Subject"),prop:"subject","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{"min-width":"130",label:t.$t("Status"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[1===a.status?i("el-tag",{attrs:{effect:"plain",size:"small",type:"info"}},[t._v(t._s(t.$t("Closed")))]):t._e(),0===a.status&&0===a.reply_status?i("el-tag",{attrs:{effect:"plain",size:"small",type:"success"}},[t._v(t._s(t.$t("Replied")))]):t._e(),0===a.status&&1===a.reply_status?i("el-tag",{attrs:{effect:"plain",size:"small",type:"danger"}},[t._v(t._s(t.$t("Pending")))]):t._e()]}}])}),i("el-table-column",{attrs:{"min-width":"160",label:t.$t("Create Date"),align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[t._v(" "+t._s(t._f("parseTime")(i.created_at,"{y}-{m}-{d} {h}:{i}"))+" ")]}}])}),i("el-table-column",{attrs:{"min-width":"112",label:t.$t("Operate"),fixed:"right",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[i("el-button",{attrs:{type:"text"},on:{click:function(e){return t.handleView(a)}}},[t._v(t._s(t.$t("View")))]),i("span",{staticStyle:{color:"#ddd",margin:"0 6px"}},[t._v("|")]),i("el-button",{attrs:{type:"text",disabled:1===a.status},on:{click:function(e){return t.handelClose(a)}}},[t._v(t._s(t.$t("Close")))])]}}])})],2),t.total?i("Pagination",{attrs:{total:t.total,page:t.listQuery.current,limit:t.listQuery.page_size,layout:"total,prev,pager,next,jumper"},on:{"update:page":function(e){return t.$set(t.listQuery,"current",e)},"update:limit":function(e){return t.$set(t.listQuery,"page_size",e)},pagination:t.getList}}):t._e()],1)])]),i("el-dialog",{staticClass:"xdialog",attrs:{visible:t.dialogNew,width:"600px",title:t.$t("Customer Service"),"lock-scroll":!1},on:{"update:visible":function(e){t.dialogNew=e}}},[i("div",{staticClass:"tips",staticStyle:{margin:"-6px 0 22px 0","font-size":"13px"}},[i("div",{domProps:{innerHTML:t._s(t.$t("kefu_desc"))}})]),i("div",{staticClass:"center-box",staticStyle:{padding:"0"}},[i("el-form",{ref:"newForm",attrs:{model:t.formData,rules:t.rules,"label-position":"top"}},[i("el-form-item",{attrs:{label:t.$t("Subject"),prop:"subject"}},[i("el-input",{style:{width:"100%"},attrs:{placeholder:t.$t("input_subject"),clearable:"",maxlength:"60","show-word-limit":""},model:{value:t.formData.subject,callback:function(e){t.$set(t.formData,"subject",e)},expression:"formData.subject"}})],1),i("el-form-item",{attrs:{label:t.$t("Content"),prop:"message"}},[i("el-input",{style:{width:"100%"},attrs:{placeholder:t.$t("input_content"),"show-word-limit":"",type:"textarea",rows:3,maxlength:"300"},model:{value:t.formData.message,callback:function(e){t.$set(t.formData,"message",e)},expression:"formData.message"}})],1)],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogNew=!1}}},[t._v(t._s(t.$t("Cancel")))]),i("el-button",{attrs:{type:"primary",loading:t.loadingAdd},on:{click:t.handleCreate}},[t._v(t._s(t.$t("Confirm Submit")))])],1)]),t.listMsg?i("el-dialog",{ref:"xdialog",staticClass:"xdialog no_close p0",attrs:{visible:t.dialogView,width:"680px",top:"8vh","lock-scroll":!1,"before-close":t.viewClose},on:{"update:visible":function(e){t.dialogView=e}}},[i("template",{slot:"title"},[i("div",{staticClass:"header1"},[t.loadingDetail?i("i",{staticClass:"el-icon-loading",staticStyle:{"font-size":"20px"}}):t._e(),1===t.listMsg.status?i("span",{staticStyle:{color:"#666"}},[t._v("["+t._s(t.$t("Closed"))+"]")]):t._e(),0===t.listMsg.status&&0===t.listMsg.reply_status?i("span",{staticStyle:{color:"green"}},[t._v("["+t._s(t.$t("Replied"))+"]")]):t._e(),0===t.listMsg.status&&1===t.listMsg.reply_status?i("span",{staticStyle:{color:"#CC9900"}},[t._v("["+t._s(t.$t("Pending"))+"]")]):t._e(),t._v(" "+t._s(t.listMsg.subject)+" ")])]),i("div",{staticClass:"tk-box-a"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingDetail,expression:"loadingDetail"}],ref:"refTkbox",staticClass:"tk-box",on:{click:function(e){t.isEmoji=!1}}},t._l(t.listMsg.message,(function(e,a){return i("div",{key:a,staticClass:"chat_item",class:e.is_me?"is_me":""},[e.is_me?t._e():i("div",{staticClass:"u-avatar"},[i("svg-icon",{attrs:{"icon-class":"me","class-name":"img-svg"}})],1),i("div",{staticClass:"u-contant",class:e.is_me?"is_me":""},[i("span",{staticClass:"u-name"},[e.is_me?t._e():i("span",[t._v("["+t._s(t.$t("Service"))+"]")]),t._v(" "+t._s(t._f("parseTime")(e.created_at,"{y}-{m}-{d} {h}:{i}"))+" ")]),i("div",{staticClass:"contants"},[e.message.startsWith("img-")?i("div",[i("el-image",{staticClass:"img",attrs:{lazy:"",src:e.message.replace(/img-/g,""),"preview-src-list":[e.message.replace(/img-/g,"")]}})],1):i("div",[i("div",{staticClass:"contant",class:e.is_me?"is_me":"",style:t.haveEmoji(e.message)?"font-size:18px;":"",domProps:{innerHTML:t._s(e.message)}})])])]),e.is_me?i("div",{staticClass:"u-avatar"},[i("svg-icon",{attrs:{"icon-class":"user","class-name":"img-svg"}})],1):t._e()])})),0),1!=t.listMsg.status?i("div",{staticClass:"answer_box"},[i("label",{staticClass:"icon-item",attrs:{for:"file-upload"}},[i("input",{staticStyle:{display:"none"},attrs:{name:"file_info",type:"file",id:"file-upload",accept:"image/*"},on:{change:t.handleFileUpload}}),i("svg-icon",{attrs:{"icon-class":"image","class-name":"icon2"}})],1),i("el-input",{ref:"inputMsg",staticClass:"answer",attrs:{placeholder:t.$t("Enter reply content")+"...",size:"large","show-word-limit":"",maxlength:"200"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handelAnswer(t.listMsg)}},model:{value:t.answerMsg,callback:function(e){t.answerMsg=e},expression:"answerMsg"}},[i("svg-icon",{attrs:{slot:"prefix","icon-class":"icon","class-name":"icon"},on:{click:function(e){t.isEmoji=!t.isEmoji}},slot:"prefix"})],1),i("el-button",{attrs:{type:"primary",icon:"el-icon-s-promotion",loading:t.loadingReply,size:"large"},on:{click:function(e){return t.handelAnswer(t.listMsg)}}},[t._v(t._s(t.$t("Send")))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isEmoji,expression:"isEmoji"}],staticClass:"emoji_box"},t._l(t.emojiList,(function(e,a){return i("div",{key:a,staticClass:"emj"},[i("span",{staticClass:"em",on:{click:function(i){return t.select(e)}}},[t._v(t._s(e))])])})),0)],1):i("div",{staticClass:"answer_box",staticStyle:{"text-align":"center","justify-content":"center"}},[i("el-button",{attrs:{type:"text",disabled:!0}},[t._v(t._s(t.$t("Closed")))])],1)])],2):t._e(),i("el-dialog",{staticClass:"xdialog",attrs:{top:"12vh",center:"",width:"500px",title:t.$t("Send Image"),visible:t.picVisible,"close-on-click-modal":!1,"lock-scroll":!1},on:{"update:visible":function(e){t.picVisible=e},close:t.picVisible_close}},[i("el-image",{staticStyle:{width:"100%",height:"300px"},attrs:{src:t.dialogImageUrl}}),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info"},on:{click:function(e){t.picVisible=!1}}},[t._v(t._s(t.$t("Cancel")))]),i("el-button",{attrs:{type:"primary",loading:t.imgSendLoading},on:{click:t.uploadImage}},[t._v(t._s(t.$t("Confirm Send")))])],1)],1),i("home-footer")],1)},s=[],n=i("2909"),r=i("1da1"),o=(i("99af"),i("5319"),i("ac1f"),i("2b3d"),i("d3b7"),i("3ca3"),i("ddb0"),i("b680"),i("96cf"),i("c24f")),l=i("333d"),c={components:{Pagination:l["a"]},data:function(){return{listLoading:!1,listData:[],listQuery:{current:1,page_size:10},total:0,btnLoading:!1,actLoading:!1,timer:"",dialogView:!1,dialogNew:!1,formData:{subject:"",level:0,message:""},rules:{subject:[{required:!0,message:this.$t("input_subject"),trigger:"blur"}],level:[{required:!0,message:"请选择对话等级",trigger:"blur"}],message:[{required:!0,message:this.$t("input_content"),trigger:"blur"}]},loadingAdd:!1,listMsg:{},answerMsg:"",loadingDetail:!1,loadingReply:!1,isEmoji:!1,emojiList:["😃","😄","😁","😆","😅","🤣","😂","🫠","😉","😊","😇","🥰","😍","🤩","😘","😗","😚","😙","🥲","🤑","🤗","🫢","🤨","😶","🫥","😶‍🌫️","🫡","❤️","😺","🙈","🫰","🤝","👏","💪","👄"],picVisible:!1,dialogImageUrl:"",uploadFile:"",imgSendLoading:!1,currentRow:{},currentMessage:{}}},mounted:function(){var t=this;this.getList(),document.addEventListener("visibilitychange",(function(){document.hidden?clearInterval(t.timer):t.dialogView&&t.currentRow.id&&(t.getDetails2(),t.getDetailsLoop())}))},destroyed:function(){this.viewClose()},methods:{getList:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.listLoading=!0,e.next=3,Object(o["D"])(t.listQuery).then(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.listLoading=!1,t.listData=i.data,t.total=i.total;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.listLoading=!1}));case 3:case"end":return e.stop()}}),e)})))()},getDetails:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return e.loadingDetail=!0,e.listMsg=[],i.next=4,Object(o["D"])({id:t.id}).then(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(i){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.currentMessage=i.data.message.length?i.data.message[i.data.message.length-1]:{},console.log(e.currentMessage),e.listMsg=i.data,e.loadingDetail=!1,setTimeout((function(){e.$refs.refTkbox.scrollTo(0,e.$refs.refTkbox.scrollHeight+9999)}),100);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.loadingDetail=!1}));case 4:case"end":return i.stop()}}),i)})))()},getDetails2:function(){var t=this;if(!this.currentRow.id||!this.currentMessage.id)return"";var e={id:this.currentRow.id,lastId:this.currentMessage.id};Object(o["D"])(e).then((function(e){var i=e.data.message;t.$nextTick((function(){t.listMsg.status=e.data.status,t.listMsg.reply_status=e.data.reply_status})),i.length&&(t.currentMessage=i.length?i[i.length-1]:{},t.$message({title:t.$t("sysNotice"),message:"".concat(t.$t("Received new reply")," (").concat(i.length,")"),type:"info"}),t.listMsg.message=[].concat(Object(n["a"])(t.listMsg.message),Object(n["a"])(i)),setTimeout((function(){t.$refs.refTkbox.scrollTo(0,t.$refs.refTkbox.scrollHeight+5e3)}),100))}))},getDetailsLoop:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=1,t.timer=setInterval((function(){if(i++,console.log(i),i>2e3)return clearInterval(t.timer);t.getDetails2()}),1e4);case 2:case"end":return e.stop()}}),e)})))()},handleView:function(t){if(this.currentRow=t,this.getDetails(this.currentRow),this.dialogView=!0,1==this.currentRow.status)return!1;this.getDetailsLoop()},handelClose:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return e.loadingDetail=!0,i.next=3,Object(o["C"])({id:t.id}).then(function(){var i=Object(r["a"])(regeneratorRuntime.mark((function i(a){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:e.loadingDetail=!1,t.status=1,e.$message({title:e.$t("sysNotice"),message:e.$t("Dialog has been closed"),type:"success"});case 3:case"end":return i.stop()}}),i)})));return function(t){return i.apply(this,arguments)}}()).catch((function(t){e.loadingDetail=!1}));case 3:case"end":return i.stop()}}),i)})))()},viewClose:function(){this.dialogView=!1,this.isEmoji=!1,this.currentRow={},clearInterval(this.timer)},handleCreate:function(){var t=this;this.$refs["newForm"].validate((function(e){e&&(t.loadingAdd=!0,Object(o["G"])(t.formData).then((function(e){t.loadingAdd=!1,t.dialogNew=!1,t.getList(),t.formData={subject:"",level:0,message:""},t.$message({title:t.$t("sysNotice"),message:t.$t("submitYes"),type:"success"})})).catch((function(e){t.loadingAdd=!1})))}))},handelAnswer:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(e.listMsg=t,e.answerMsg&&!(e.answerMsg.length<1)){i.next=4;break}return setTimeout((function(){e.$refs.inputMsg.focus()}),100),i.abrupt("return",e.$message.error(e.$t("Enter reply content")));case 4:return e.loadingReply=!0,i.next=7,Object(o["E"])({id:e.listMsg.id,message:e.answerMsg}).then(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(i){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.loadingReply=!1,e.answerMsg="",i.data&&(a=i.data,e.listMsg.message.push(a),e.listMsg.reply_status=1,e.$message({title:e.$t("sysNotice"),message:e.$t("submitYes"),type:"success"}),setTimeout((function(){e.$refs.refTkbox.scrollTo(0,e.$refs.refTkbox.scrollHeight+9999)}),100));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){console.log(t),e.loadingReply=!1}));case 7:case"end":return i.stop()}}),i)})))()},wrapEmojisWithSpan:function(t){var e=/([\u203C-\u3299]|[\uD83C-\uDBFF][\uDC00-\uDFFF])/g,i=t.replace(e,(function(t){return'<span style="font-size:22px;>'.concat(t,"</span>")}));return i},haveEmoji:function(t){var e=/([\u203C-\u3299]|[\uD83C-\uDBFF][\uDC00-\uDFFF])/,i=e.test(t);return!!i},select:function(t){var e="".concat(t);this.answerMsg+=e,this.isEmoji=!1},handleFileUpload:function(t){var e=t.target.files[0];if(-1==e.type.indexOf("image/"))return this.$message.error(this.$t("upload_error_ext"));this.dialogImageUrl=URL.createObjectURL(e),this.uploadFile=e,this.dialogImageUrl&&this.handlePictureCardPreview(this.dialogImageUrl)},handlePictureCardPreview:function(t){this.picVisible=!0},picVisible_close:function(){this.dialogImageUrl="",this.uploadFile="",this.picVisible=!1},uploadImage:function(){var t=this,e=this.uploadFile.size/1024/1024;if(e=e.toFixed(2),e>2)return this.$message.error(this.$t("upload_error_size")+"2MB");var i=new FormData;i.append("file_info",this.uploadFile),i.append("id",this.listMsg.id),this.imgSendLoading=!0,Object(o["F"])(i).then((function(e){if(t.imgSendLoading=!1,t.answerMsg="",e.data){var i=e.data;t.listMsg.message.push(i),t.picVisible_close(),t.$message({title:t.$t("sysNotice"),message:t.$t("submitYes"),type:"success"}),setTimeout((function(){t.$refs.refTkbox.scrollTo(0,t.$refs.refTkbox.scrollHeight+9999)}),100)}})).catch((function(e){t.$message.error(t.$t("submitNo")),t.imgSendLoading=!1}))}}},u=c,d=(i("c941"),i("c3dc"),i("2877")),g=Object(d["a"])(u,a,s,!1,null,"73bad467",null);e["default"]=g.exports},"1dfa":function(t,e,i){},"263b":function(t,e,i){"use strict";i("ea52")},"333d":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:[{hidden:t.hidden},{"pagination-container":t.classA}]},[i("el-pagination",t._b({attrs:{background:t.background,"current-page":t.currentPage,"page-size":t.pageSize,layout:t.layout,"page-sizes":t.pageSizes,total:t.total,"pager-count":t.pagercount},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}},"el-pagination",t.$attrs,!1))],1)},s=[];i("a9e3");Math.easeInOutQuad=function(t,e,i,a){return t/=a/2,t<1?i/2*t*t+e:(t--,-i/2*(t*(t-2)-1)+e)};var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();function r(t){document.documentElement.scrollTop=t,document.body.parentNode.scrollTop=t,document.body.scrollTop=t}function o(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function l(t,e,i){var a=o(),s=t-a,l=20,c=0;e="undefined"===typeof e?500:e;var u=function t(){c+=l;var o=Math.easeInOutQuad(c,a,s,e);r(o),c<e?n(t):i&&"function"===typeof i&&i()};u()}var c={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},pagercount:{type:Number,default:5},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1},classA:{type:Boolean,default:!0}},computed:{currentPage:{get:function(){return this.page},set:function(t){this.$emit("update:page",t)}},pageSize:{get:function(){return this.limit},set:function(t){this.$emit("update:limit",t)}}},methods:{handleSizeChange:function(t){this.$emit("pagination",{page:this.currentPage,limit:t}),this.autoScroll&&l(0,800)},handleCurrentChange:function(t){this.$emit("pagination",{page:t,limit:this.pageSize}),this.autoScroll&&l(0,800)}}},u=c,d=(i("263b"),i("2877")),g=Object(d["a"])(u,a,s,!1,null,"2670f324",null);e["a"]=g.exports},b38d:function(t,e,i){},c3dc:function(t,e,i){"use strict";i("b38d")},c941:function(t,e,i){"use strict";i("1dfa")},ea52:function(t,e,i){}}]);